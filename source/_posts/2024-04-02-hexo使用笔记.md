---
title: hexo使用笔记
tag:
  - hexo
categories:
  - [博客,hexo]
article_type: 0
no_word_count: false
no_toc: false
no_date: false
no_declare: false
no_reward: false
no_comments: false
no_share: false
no_footer: false
mathjax: false
typora-root-url: ./..
top: 1
abbrlink: f431f6d
date: 2024-04-02 10:45:50
---

## 按照模版创建 md

```
hexo new [layout] <title>
```

- layout 是文章的布局，在 scaffolds 中，默认为 post，可以先不写，其他的有 page、draft 等
- Hexo 有三种默认布局：`post`、`page` 和 `draft` 在创建者三种不同类型的文件时，它们将会被保存到不同的路径。

| 布局  | 路径           |
| ----- | -------------- |
| post  | source/_posts  |
| page  | source         |
| draft | source/_drafts |

<!--more-->

## Front-matter 参数（文章表头参数）

Front-matter 是文章最上方以—分隔的区域，用于指定文章的变量设置

| 参数       | 描述               | 默认值                         |
| ---------- | ------------------ | ------------------------------ |
| layout     | 布局               | 无                             |
| title      | 标题               | 无                             |
| date       | 建立日期           | 文件建立日期（常用于文章排序） |
| updated    | 更新日期           | 文件更新日期                   |
| comments   | 开启文章的评论功能 | true                           |
| tags       | 标签               | （不适合分页）                 |
| categories | 分类               | （不适合分页）                 |
| permalink  | 覆盖文章网址       | 无                             |

## 多层级分类

### 单层分类

如果你的一篇文章只分一类，可以像如下方式设置分类名：

```
categories:
  - 博客
```

### 文章处于父类中的子类中

```
categories:
  - 博客
  - hexo
```

### 并列分类

```
categories:
  - [博客,hexo]
  - [博客,hexo1]
```

#### 同一父类不同子类

如果你想让一篇文章处于同一父类的不同类中，可以像如下方式设置分类名：

```
categories:
  - [博客,hexo]
```



## 默认排序规则

​	依据创建时间（date)，如无依据文件创建时间

​	安装 hexo-generator-index-pin-top 插件后，排序规则 top--> date--> 文件创建时间



## Hexo 博客新建文章后自动打开编辑器

  hexo new 命令创建新的文章后，需要重新在文件夹里打开才能编辑，较为麻烦，所以加一个 js 脚本，实现创建新文件之后自动打开。

- 在 `Hexo` 博客的根目录下的 `scripts` 目录中创建一个 `JavaScript` 脚本文件（如 person_blog_new）。

- 如果没有这个

  ```
  scripts
  ```

  目录，则新建一个。

  - 新建目录

  mkdir scripts

- `scripts` 目录新建的 `js` 脚本文件可以任意取名, 建议 `auto_open.js`。

- `windows` 平台的 `Hexo` 用户操作如下：

```javascript
var exec = require('child_process').exec;
hexo.on('new', function(data){
  exec('start  "C:\Program Files\Typora\bin\typora.exe" ' + data.path);
  //如果路径存在空格使用下面这个
 //exec('start  "D:\software_install\Typora\Typora.exe" ' + `"${data.path}"`); 
});
```

然后再创建文件输入命令之后就会自动打开 Typora 编辑器来编辑你新建的文章了。

```javascript
hexo new "auto open editor test"
```

## 通过 GithubActions 实现自动化部署 Hexo

### 基础配置

在自己电脑上新建一个文件夹，打开 git bash here, 输入以下命令

```bash
# 生成秘钥
ssh-keygen -f github-deploy-key
```

之后会生成两个文件，

一个私钥文件为：github-deploy-key；

另一个公钥文件为：github-deploy-key.pub 



1、在 Hexo 工作目录 Github 源码仓库中指定私钥（多个仓库都使用 action 时，每个仓库配置的 key 取名需要不一样，配置的内容都是私钥）

步骤：依次打开自己存放博客源码的仓库，点击 Settings-> 展开 Secrets and variables-> 点击 Actions-> 点击 New repository secret; 填写名称与粘贴私钥。



2、在 Hexo 站点目录 Github pages 主页仓库中指定公钥

步骤：依次打开自己存放博客 pages 主页的仓库，点击 Settings-> Deploy keys-> Add deploy key

Title 处设置个名称，key 处粘贴公钥。

注意事项：一定要勾选（Allow write access）允许写入后，再保存。【可能已经在整体设置里面设置了，提示已经存在，不需要再次设置公钥】

### 创建部署配置

1、在 `[自己博客根目录]` 新建 `.github` 文件夹, 注意开头是有个 `.` 的。然后在 `.github` 内新建 `workflows` 文件夹，再在 `workflows` 文件夹内新建 `autodeploy.yml`, 在 `[自己博客根目录]/.github/workflows/autodeploy.yml` 里面输入

```bash
name: 部署 Hexo 到 GithubPage
on:
  push:
    branches: [ "master" ] #这里要更改为自己的源码仓库分支名称master或main
jobs:
  HexoDeploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x] #这里要更改为自己电脑安装的node.js版本，在终端用node -v查找
    steps:
    - uses: actions/checkout@v3
    - name: 使用 Node.js ${{ matrix.node-version }} 环境
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
    - name: 配置 SSH 环境和 Git 环境
      env:
        ACTION_DEPLOY_KEY: ${{ secrets.名字 }} #这里要接合前面的内容更改为自己源码仓库填写私钥时，所取的名称
      run: |
        mkdir -p ~/.ssh/
        echo "$ACTION_DEPLOY_KEY" > ~/.ssh/id_rsa
        chmod 700 ~/.ssh
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan github.com >> ~/.ssh/known_hosts
        git config --global user.email "这里要填写自己github注册时所用的邮箱"
        git config --global user.name "这里要填写自己gitub的用户名"
    - name: 配置 Hexo 环境
      run: |
        export TZ='Asia/Shanghai'
        npm install hexo-cli -g
    - name: 下载 Npm 依赖
      run: |
        npm install
    - name: 部署博客
      run: |
        hexo d
```

## bat 自动处理 hexo 命令

每次写新文章都得 hexo new “xxx”，写完再 hexo g -d，挺麻烦的。 就不能写一个脚本来自动执行吗？

* * *

### 创建 hexo 文章

之前写文章都得打开 cmd, 输入 hexo new “XXX”。 然后再去目录下找生成的.md 文件打开编辑。 这样的机械动作不应该用程序就可以做到吗？

#### create_post.bat

```javascript
@echo off
set /p name=input pages name:
echo name:%name%
echo please wait
hexo new %name% && start /min /w mshta vbscript:setTimeout("window.close()",2000) && call open_page.bat %name%
pause
```

#### open_page.bat

```javascript
start /min /w mshta vbscript:setTimeout("window.close()",1000)
echo The InputValue is %1
set name=%1
echo %name%
start /d "D:\software_install\Typora"   Typora.exe  "E:\OneDrive - shjd\github\person_blog_new\source\_posts\%name%.md"
pause
```

- start /min /w mshta vbscript: setTimeout("window.close()",1000) 等待 1000 毫秒
- /d " D:\software_install\Typora 修改为自己打开 md 的程序位置
- Typora.exe 修改为自己的程序 exe
- E:\OneDrive - shjd\github\person_blog_new\source\_posts\" 修改为博客创建 md 存放的路径

![image-20240409134153885](/imgs/image-20240409134153885.png)

每次点击“创建 hexo 文章.bat”输入文章名，Typora 就会自动打开编辑了。

### 发布文章到 github

编辑完 markdown 文章后再发到 github 上，博客才会显示。 一般命令：

#### clean.bat

```javascript
@echo off
echo clean
echo Please wait
hexo clean
exit
```

#### generate_deploy.bat

```javascript
hexo g -d
pause
```

#### backup.bat

```
hexo b
pause
```



- clean.bat 一键清理
- generate_deploy.bat 一键生成 html、发布
- generate_deploy.bat 一键备份

## hexo 使用草稿方式写作博客

在写作 Hexo 博客时，经常有几篇博文同时在构思，直接使用 "hexo new <article title>" 创建的博文，在执行 "hexo d" 的时候会直接部署到博客正式发表。  
但此时，可能同时进行写作的其他博文还没有完成，就会出现未完成博文也同时被正式部署的尴尬情况。

在这种情况下，我们可以使用 hexo 博客的草稿功能。所谓草稿，就是我们创建的博文作为草稿单独存放，等编辑完成后，再放置到正式发布用的文件夹。作为草稿的文章，不会在执行 "hexo d" 时被部署。

#### 创建草稿文章

草稿其实是 Hexo 的一种特殊布局: draft，它在建立时会被保存到 " 博客根目录/source/\_drafts "文件夹，而非 draft 布局的文章会被保存到" 博客根目录/source/\_posts " 文件夹。

**创建草稿**  
打开终端 Terminal，切换（cd）到博客根目录，执行下面语句：

```bash
$ hexo new draft "0007.How to add a draft blog article"
```

命令执行后，可以在 " 博客根目录/source/\_drafts " 找到该文章，但\_posts/文件夹下不存在该文章。

<!--more-->

```bash
$ cd source
$ ls _drafts/
0007-How-to-add-a-draft-blog-article.md
$ ls _posts/0007-How-to-add-a-draft-blog-article.md
ls: _posts/0007-How-to-add-a-draft-blog-article.md: No such file or directory
```

打开文章的 md 文件，可以看到文章已经自动生成了文件头：

```md
---
title: 0007.How to add a draft blog article
tags:
---
```

此时，即使执行 "hexo g"，草稿文章也不会生成静态页面，因此执行 "hexo s" 也无法本地预览。

#### publish 草稿

编辑 md 文件完成博文写作后，可以将文章移动到\_posts/文件夹中，就可以作为部署对象了。执行下面命令，将文章从\_drafts/文件夹转移到\_posts/文件夹，后续该文章就可以正常生成静态页面、进行本地预览或线上部署。

```bash
$ hexo p "0007.How to add a draft blog article"
$ ls _posts/0007-How-to-add-a-draft-blog-article.md  # _posts文件夹下已存在该文章
_posts/0007-How-to-add-a-draft-blog-article.md
```

#### 备注

  hexo p 移动到_post 中后，标题的 categories、tag 可能需要修改。

综上，hexo 的草稿功能可以让我们同时编辑多篇文章，而使它们在部署时互不影响。

## hexo 利用 cloudflare CDN 实现 github 加速

### 概述

由于 GitHub Pages 在国外，而且有时候因为图片过多等原因，静态博客页面在国内访问速度可能会非常慢，我们可以用 CDN 来加速，发现 CloudFlare 免费版没有流量限制，而且配置起来非常简单，所以在此选用 CloudFlare CDN 来加速页面访问。

参考博客（七夏浅笑）[https://www.julydate.com/post/60859300/](https://www.julydate.com/post/60859300/)

### 准备

+   域名
+   CloudFlare 账号
+   github\_username.github.io 静态博客

### 流程

#### CloudFlare 账号注册登陆

#### 将顶级域名添加到 Cloudflare

![image-20240408101310641](/imgs/image-20240408101310641.png)

#### 配置 DNS

![image-20240408101340005](/imgs/image-20240408101340005.png)

#### 修改域名的 DNS 到 Cloudflare

![image-20240408101519712](/imgs/image-20240408101519712.png)

![image-20240408101534578](/imgs/image-20240408101534578.png)



### 使用 CloudFlare 导致网站“重定向的次数过多”解决方案

使用 CloudFlare 之后，用 Chrome 打开网站，会显示“重定向的次数过多”类似的错误信息。

解决办法：

进入 CloudFlare，找到域名下的 SSL/TLS 设置，把加密模式设置为安全或者安全（严格）即可。

## hexo 博客如何添加分类、标签



Hexo 默认带有不少菜单，如关于（about）、分类（categories）、标签（tags）等，默认处于注释状态，将需要取消的菜单注释掉，然后生成相应的 page 即可。

1、打开 `~\themes\xxx\_config.yml` 文件，找到 `menu` 相关的设置，取消掉需要的菜单项的注释。

2、重新生成部署后，可以看到新增的菜单项，但是单击后会报如下错误

```bash
Cannot GET /about/
Cannot GET /tags/
Cannot GET /categories/
Cannot GET /archives/

```

3、这是因为还需要运行如下命令新建相关 page

```cpp
hexo new page "about"
hexo new page "tags"
hexo new page "categories"
hexo new page "archives"
```

<!--more-->

4、新建 page 后，会在 source 目录下新建 `about`、`tags`、`categories`、`archives` 文件夹，每个文件夹下还会创建一个 `index.md` 文件表示关于、标签页分类页面，编辑这三个 MarkDown 文件可以自定义这三个页面的内容.

5、最后一步，编辑各页面对应的 `index.md` 文件，增加 type 即可。注意冒号 : 后必须空一格，title 和 date 是默认生成的。重新部署后能够看到效果。

```yml
---
title: about
date: 2021-03-13 15:21:30
type: "about"
---
 
---
title: tages
date: 2021-03-13 15:21:30
type: "tags"
---
 
---
title: categories
date: 2021-03-13 15:21:30
type: "categories"
---

---
title: archives
---
```

6、在新建博文的头部，直接输入该博文的分类、标签等即可。分类只能有一个，标签能有多个，多个标签不能一行，注意下面的格式。

```yml
---
title: Hello World # 标题
date: 2019/3/26 hh:mm:ss # 时间
categories: # 分类
	- 分类  # 只能由一个
tags: # 标签
	- PS3  # 能有多个
	- Games  # 一个标签一行
---

摘要
<!--more-->
正文
```

7、对应关系

 

| page       | type       | 内容             |
| ---------- | ---------- | ---------------- |
| tags       | tags       | 标签             |
| categories | categories | 分类             |
| archives   | archives   | 归档             |
| about      | about      | 关于我(自我介绍) |

## Hexo 插件安装

[Hexo](https://hexo.io/zh-cn/) 是一个快速、简洁且高效的博客框架，个人只需用 Markdown 来写文档，并且拥有丰富的插件和主题。当前博客就是使用 Hexo 配合 NexT 主题搭建的

因为笔者个人在 Windows 环境下写博客，后续命令均以 [PowerShell](https://docs.microsoft.com/zh-cn/powershell/scripting/install/installing-powershell?view=powershell-7.2) 为例

### 插件汇总

| 插件                         | 功能                                                    | 文档链接                                                     |
| ---------------------------- | ------------------------------------------------------- | ------------------------------------------------------------ |
| **hexo-git-backup**          | **支持 hexo b 一键备份**                                  |                                                              |
| **hexo-deployer-git**        | **支持一键部署网站到 git 仓库上**                       |                                                              |
| hexo-generator-index-pin-top | 文章置顶                                                | https://github.com/netcan/hexo-generator-index-pin-top       |
| hexo-wordcount               | 文章字数统计和阅读时长统计                              | https://github.com/willin/hexo-wordcount                     |
| **hexo-abbrlink**            | **生成 URL 短链接**                                       | https://github.com/rozbo/hexo-abbrlink                       |
| hexo-lazyload-image          | 图片懒加载                                              | https://github.com/Troy-Yang/hexo-lazyload-image             |
| hexo-generator-baidu-sitemap | 生成 baidusitemap.xml                                    | https://github.com/coneycode/hexo-generator-baidu-sitemap    |
| hexo-generator-sitemap       | 生成 sitemap.xml                                         | https://github.com/hexojs/hexo-generator-sitemap             |
| hexo-generator-feed          | 生成 RSS 文件                                             | https://github.com/hexojs/hexo-generator-feed                |
| hexo-external-link           | 外链跳转                                                | https://github.com/hvnobug/hexo-external-link                |
| hexo-autonofollow            | 自动对外部链接增加 nofollow 属性                          | https://github.com/liuzc/hexo-autonofollow                   |
| hexo-filter-nofollow         | 为外链添加 `rel="noopener external nofollow noreferrer"` | https://github.com/hexojs/hexo-filter-nofollow               |
| hexo-prism-plugin            | 代码高亮                                                | https://github.com/ele828/hexo-prism-plugin                  |
| hexo-neat                    | 博客压缩                                                | https://github.com/rozbo/hexo-neat                           |
| hexo-allminifier             | 博客压缩                                                | https://developer.aliyun.com/mirror/npm/package/hexo-all-minifier |
| hexo-tag-aplayer             | aplayer 音乐播放器                                       | https://github.com/MoePlayer/hexo-tag-aplayer                |
| hexo-tag-dplayer             | dplayer 视频播放器                                       | https://github.com/MoePlayer/hexo-tag-dplayer                |
| hexo-douban                  | 添加豆瓣读书，电影，游戏页面                            | https://github.com/mythsman/hexo-douban                      |
| hexo-generator-searchdb      | 本地搜索, 生成 search.xml                                 | https://github.com/theme-next/hexo-generator-searchdb        |
| hexo-algoliasearch           | 搜索系统                                                | https://github.com/LouisBarranqueiro/hexo-algoliasearch      |
| hexo-algolia                 | 搜索系统                                                | https://github.com/oncletom/hexo-algolia                     |
| hexo-generator-search        | 本地搜索系统                                            | https://github.com/wzpan/hexo-generator-search               |
| hexo-baidu-url-submit        | 百度站长主动推送                                        | https://github.com/huiwang/hexo-baidu-url-submit             |
| hexo-offline                 | 开启 PWA                                                 | https://github.com/JLHwung/hexo-offline                      |
| hexo-pwa                     | 开启 PWA                                                 | https://github.com/lavas-project/hexo-pwa                    |
| hexo-helper-live2d           | 看板娘                                                  | https://github.com/EYHN/hexo-helper-live2d                   |
| hexo-addlink                 | 文末添加当前文章链接和版权声明                          | https://github.com/acwong00/hexo-addlink                     |
| **hexo-blog-encrypt**        | **博客文章加密**                                        | https://github.com/MikeCoder/hexo-blog-encrypt               |
| hexo-simple-mindmap          | 博客添加脑图                                            | https://github.com/HunterXuan/hexo-simple-mindmap            |
| hexo-pdf                     | 博客展示 pdf                                             | https://github.com/superalsrk/hexo-pdf                       |
| hexo-tag-echarts             | 博客添加图表                                            | https://github.com/zhoulvjun/hexo-tag-echarts                |
| hexo-steam-games             | 添加 Steam 游戏界面                                       | https://github.com/HCLonely/hexo-steam-games                 |
| hexo-bilibili-bangumi        | 添加 bilibili 番剧页面                                    | https://github.com/HCLonely/hexo-bilibili-bangumi            |
| hexo-generator-random        | 生成随机文章页面                                        | https://github.com/Drew233/hexo-generator-random             |

### 插件推荐

#### [hexo-deployer-git](https://github.com/hexojs/hexo-deployer-git)

Hexo 支持一键部署网站到 git 仓库上，其他的一键部署方式参考 [官网介绍](https://hexo.io/zh-cn/docs/one-command-deployment)

+   安装

```ps
npm install hexo-deployer-git --save
```

+   配置

```yml
deploy:
  type: git
  repo: <仓库链接> # 可以是 https 链接也可以是 git 链接
  branch: [分支] # GitHub 的网站分支为 gh-pages，其他网站可能有所不同
  message: [message] # 默认是 Site updated: {{ now('YYYY-MM-DD HH:mm:ss') }}
```

默认的提交信息只有时间信息，没有过多的参考价值推荐使用自定义提交信息，具体参考 [后续小节](#t7)

<!--more-->

#### [hexo-word-counter](https://github.com/next-theme/hexo-word-counter)

显示每篇文章的字数统计以及大致阅读时长，需要主题支持

+   安装

```ps
npm install hexo-word-counter --save
```

+   配置

```yml
# hexo-word-counter
## https://github.com/next-theme/hexo-word-counter
symbols_count_time:
  symbols: true
  time: true
  total_symbols: false
  total_time: false
  exclude_codeblock: false
  awl: 4
  wpm: 275
  suffix: "mins."
```

具体配置可以参考官方给出的说明：

> Note for Chinese users: because in Chinese language average word length about ~1.5 and if you at most cases write posts in Chinese (without mixed English), recommended to set awl to 2 and wpm to 300.  
> But if you usualy mix your posts with English, awl to 4 and wpm to 275 will be nice.

也就是说纯中文时推荐 `awl` 设为 2，`wpm` 设为 300；而中英文混合时推荐 `awl` 设为 4，`wpm` 设为 275

#### [hexo-abbrlink](https://github.com/rozbo/hexo-abbrlink)

Hexo 默认的文章链接是以时间以及文件名命名的，如果文件名为中文时转译之后会很长，并且不美观。而该插件可以利用 hash 值替换原有的文章链接

+   安装

```ps
npm install hexo-abbrlink --save
```

+   配置

首先修改 `_config.yml` 文件中的 `permalink` 的配置

```yml
permalink: posts/:abbrlink.html
```

再增加以下配置

```yml
# abbrlink config
## https://github.com/rozbo/hexo-abbrlink
abbrlink:
  alg: crc32 # support crc16(default) and crc32
  rep: hex # support dec(default) and hex
  drafts: true # (true)Process draft,(false)Do not process draft. false(default)
  # Generate categories from directory-tree
  # depth: the max_depth of directory-tree you want to generate, should > 0
  auto_category:
     enable: true # true(default)
     depth: 3 # 3(default)
     over_write: false
  auto_title: false # enable auto title, it can auto fill the title by path
  auto_date: false # enable auto date, it can auto fill the date by time today
  force: false # enable force mode, in this mode, the plugin will ignore the cache, and calc the abbrlink for every post even it already had abbrlink.
```

#### [hexo-generator-sitemap](https://github.com/hexojs/hexo-generator-sitemap)

为了使博客能被谷歌、bing、百度收录，最好生成 `sitemap` 方便爬取，整体流程可以先参考 [这篇博文](https://ywang-wnlo.github.io/posts/abac0c46/)

+   安装

```ps
npm install hexo-generator-sitemap --save
```

+   配置

```yml
# hexo-generator-sitemap
## https://github.com/hexojs/hexo-generator-sitemap
sitemap:
  path: sitemap.xml
  # template: ./sitemap_template.xml
  rel: true
  tags: false
  categories: false
```

### 小技巧

#### 自定义提交信息

```ps
hexo deploy -m "自定义提交信息"
```

例如使用 `hexo` 仓库的提交信息来提交到 `deploy` 仓库

```ps
hexo deploy -m (git log -1 --pretty=format:%s)
```

如果中文乱码，可以参考 [这篇博客](https://blog.csdn.net/weixin_43426860/article/details/83348284) 修改 UTF-8 编码

### 参考资料

+   [【Hexo】一键部署](https://hexo.io/zh-cn/docs/one-command-deployment)
+   [【GitHub】hexo-deployer-git](https://github.com/hexojs/hexo-deployer-git)
+   [【GitHub】hexo-word-counter](https://github.com/next-theme/hexo-word-counter)
+   [【GitHub】hexo-abbrlink](https://github.com/rozbo/hexo-abbrlink)
+   [【GitHub】hexo-generator-sitemap](https://github.com/hexojs/hexo-generator-sitemap)
+   [【Git】git log 自定义输出格式](https://git-scm.com/docs/git-log#_pretty_formats)
+   [【CSDN】解决 Windows PowerShell 乱码](https://blog.csdn.net/weixin_43426860/article/details/83348284)

### 注意

​	可能需要 hexo clean 后再次 hexo g 生成页面才会生效

## hexo + typora 图片插入解决办法

### 本地图片

博客的 Markdown 文档都存储在 `source/_posts` 下，然后博客相关图片都存在 `source/imgs` 下，接着来修改 typora 的设置。

打开 `文件 - 偏好设置 - 图像` 进行修改如下图修改

![image-20240319105445610](/imgs/image-20240319105445610-1711088584797-161-1711095546048-162.png)

这样拖拽或粘贴过来的图片会自动复制到 `source/imgs` 下面，不过这样只是可以在 typora 中查看图片了，要想在 hexo 中查看就需要图片路径与服务器中相符合， `source/imgs` 文件夹下的图片在 hexo 中可以用如 `/images/abc.png` 的路径访问到，而 typora 可以设置图片根目录，设置完了后图片路径都是 `/images/abc.png` 这样的，这样一配合就解决了图片路径问题，具体做法是在 `格式 - 图像 - 设置图片根目录` 中 将 `source` 文件夹设置为图片根目录，也可在每篇 Markdown 文档中 YAML Front Matter 中添加 `typora-root-url: ..`，或者直接在 `scaffolds` 中的模板里直接添加，这样每次 `hexo new post` 时就会自动生成了。

<!--more-->

注意先设置图片根目录，再进行图片的插入。

- 设置插入图片时复制到指定目录【设置博客的的 source\imgs】
- 进行图片的插入，格式--> 图像--> 复制所有图片到 source\imgs

### 上传到图床

上边的方法适用于博客文件放在根目录的情况，如果文件放在子目录下的话暂时没找到解决办法，便直接上传到图床采用绝对路径了。

在 typora 里可以设置插入图片时自动上传，如下图设置，这里使用 `PicGo` App 来上传图片。

![BaiduShurufa_2021-5-21_20-12-18](/imgs/1091021-20220524194252672-542041269-1711088584796-145.png)

PicGo 可以点击下载按钮到浏览器下载，安装完成后配置好图床，就可以上传图片了。这里使用 GitHub 图床（SM.MS 体验应该更好）。

![image-20210521202345259](/imgs/1091021-20220524194252670-1702853471-1711088584797-147.png)

具体就是在 GitHub 新建一个仓库专门用来存放图片，然后在 PicGo 里填写 用户名/仓库名，分支一般写 main ，token 在 GitHub 设置里生成。

下边是 PicGo 文档里 GitHub 图床的详细步骤，其他图床可参考官方文档。
如果 GitHub 图片访问过慢的话，可以将自定义域名设置为 `https://fastly.jsdelivr.net/gh/{用户名}/{仓库名}@{分支名}`。
鉴于网络环境，建议自行寻找可用的图床。

> **1.** 首先你得有一个 GitHub 账号。注册 GitHub 就不用我多言。
>
> **2.** 新建一个仓库
>
> ![img](/imgs/1091021-20220524194252154-1831561448-1711088584797-149.png)
>
> 记下你取的仓库名。
>
> **3.** 生成一个 token 用于 PicGo 操作你的仓库：
>
> 访问：https://github.com/settings/tokens
>
> 然后点击 `Generate new token`。
>
> ![img](/imgs/1091021-20220524194252718-2133629352-1711088584797-151.png)
>
> 把 repo 的勾打上即可。然后翻到页面最底部，点击 `Generate token` 的绿色按钮生成 token。
>
> ![img](/imgs/1091021-20220524194252716-1501971244-1711088584797-153.png)
>
> **注意：** 这个 token 生成后只会显示一次！你要把这个 token 复制一下存到其他地方以备以后要用。
>
> ![img](/imgs/1091021-20220524194252169-302405467-1711088584797-155.png)
>
> **4.** 配置 PicGo
>
> **注意：** 仓库名的格式是 `用户名/仓库`，比如我创建了一个叫做 `test` 的仓库，在 PicGo 里我要设定的仓库名就是 `Molunerfinn/test`。一般我们选择 `main` 分支即可。然后记得点击确定以生效，然后可以点击 `设为默认图床` 来确保上传的图床是 GitHub。
>
> ![img](/imgs/1091021-20220524194252673-1828432535-1711088584797-157.png)
>
> 至此配置完毕，已经可以使用了。当你上传的时候，你会发现你的仓库里也会增加新的图片了：
>
> ![img](/imgs/1091021-20220524194252744-231276602-1711088584797-159.png)

### Reference

[typora + hexo 博客中插入图片](https://blog.csdn.net/qq_32623363/article/details/100524856)

[PicGo 文档](https://picgo.github.io/PicGo-Doc/zh/guide/config.html)

## 从目录中移除那些没有在目录 Markdown 文件引用的图片

- md 文件目录   E:\test\imgs

- 图片目录  E:\test\zfile1

- 查找图片样式 ![alt](/imgs/image.jpg)

  python 代码(Typora.py)

  ```python
  import os
  import re
  
  def get_referenced_images(md_dir, img_subdir):
      """获取Markdown文件中引用的所有图片路径"""
      referenced_images = set()
      for root, dirs, files in os.walk(md_dir):
          for file in files:
              if file.endswith('.md'):
                  md_file_path = os.path.join(root, file)
                  with open(md_file_path, 'r', encoding='utf-8') as f:
                      content = f.read()
                      # 查找图片链接，并假定链接以 '/imgs/' 开头
                      image_links = re.findall(r'!\[.*?\]\(/imgs/(.*?)\)', content)
                      referenced_images.update(image_links)
      return referenced_images
  
  def remove_unused_images(img_dir, referenced_images):
      """移除目录中未被Markdown文件引用的图片"""
      for root, dirs, files in os.walk(img_dir):
          for file in files:
              img_path = os.path.join(root, file)
              # 如果图片路径不在引用的图片集合中，则删除它
              if os.path.relpath(img_path, img_dir) not in referenced_images:
                  try:
                      os.remove(img_path)
                      print(f"Removed unused image: {img_path}")
                  except OSError as e:
                      print(f"Error removing image: {e.strerror}. {img_path}")
  
  # 设置路径
  md_directory = "E:\\test\\zfile1" # Markdown文件文件夹路径
  img_directory = "E:\\test\\imgs"  # 图片所在目录路径
  img_subdir = os.path.relpath(img_directory, md_directory)  # 图片目录相对于Markdown文件目录的路径
  
  # 获取Markdown文件中引用的图片路径
  referenced_images = get_referenced_images(md_directory, img_subdir)
  
  # 移除未引用的图片
  remove_unused_images(img_directory, referenced_images)
  ```

  修改 md_directory、img_directory，图片样式需要是/imgs/image.jpg 样式的，否则需要修改 image_links 正则



运行(最好先备份 img_directory 目录文件)

```
python Typora.py
```

## 接入 Valine 评论系统

RT，增加对 Valine 评论系统的支持。



### 前言

之前配置系统一直用的 gitment，用 github 账号登录即可评论。详见之前的文章：[添加 gitment 评论系统](http://xiaqunfeng.cc/2018/03/26/hexo-gitment/)

展示效果也很好：

![show](/imgs/gitment-show.png)

但是，现在已经凉凉了，一直登录不上去，其他人也有类似的反馈：

![1](/imgs/gitment.png)

一直转圈圈，几分钟后就失败。

本来不想再折腾评论系统了，初衷就是自己总结写给自己看的。想想万一能帮到他人，就像之前的评论一样，同时能有更多交流，也是一件很开心的事情。

### Valine 配置

官方文档：https://valine.js.org/quickstart.html

#### 获取 APP ID 和 APP Key

1、先注册 leancloud，然后实名认证

https://leancloud.cn/dashboard/login.html#/signup

2、创建应用

![create](/imgs/valine-create.png)

3、设置应用 key

进入应用，设置-> 应用 keys

![set](/imgs/valine-app.png)

#### 配置安全域名

设置成博客的域名地址和本地地址即可。不设置也可以 ，主要还是为了安全。

![security](/imgs/valine-security.png)

### yilia 主题配置

所有 hexo 主题配置可在这里找：https://valine.js.org/hexo.html

1、`_config.yml`

```
#6、Valine https://valine.js.org
valine: 
 appid:  #Leancloud应用的appId
 appkey:  #Leancloud应用的appKey
 verify: false #验证码
 notify: false #评论回复提醒
 avatar: mp #评论列表头像样式：''/mp/identicon/monsterid/wavatar/retro/hide
 placeholder: Just go go #评论框占位符
```

2、`layout/_partial/article.ejs`

给文章新增评论 style

```
<% if (theme.valine && theme.valine.appid && theme.valine.appkey){ %>
    <section id="comments" style="margin:10px;padding:10px;background:#fff;">
      <%- partial('post/valine', {
        key: post.slug,
        title: post.title,
        url: config.url+url_for(post.path)
        }) %>
    </section>
  <% } %>
```

3、`layout/_partial/post/valine.ejs`

```
<div id="vcomment" class="comment"></div> 
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
   var notify = '<%= theme.valine.notify %>' == true ? true : false;
   var verify = '<%= theme.valine.verify %>' == true ? true : false;
    window.onload = function() {
        new Valine({
            el: '.comment',
            notify: notify,
            verify: verify,
            app_id: "<%= theme.valine.appid %>",
            app_key: "<%= theme.valine.appkey %>",
            placeholder: "<%= theme.valine.placeholder %>",
            avatar:"<%= theme.valine.avatar %>"
        });
    }
</script>
```

### 测试

1、评论测试

![test](/imgs/valine-test.png)

2、查看 leancloud 数据仓库

![detail](/imgs/valine-comment-detail.png)

可以看到，评论的详细信息都被记录到这里。

### gravatar 头像

详见头像配置：https://valine.js.org/avatar.html

之前使用的是默认的 mp 匿名头像。

1、登录 [gravatar](https://cn.gravatar.com/)，注册账号并设置头像，我的头像如下，和博客头像一致。

![gravatar](/imgs/valine-gravatar.png)

2、主题配置文件增加 avatar_cdn 参数：

在上面 `_config.yml` 配置中增加：（和参数 avatar 同级）

```
avatar_cdn: https://www.gravatar.com/avatar/
```

3、设置 gravatar CDN

目前 Valine 的版本不支持 avatar_cdn 参数，这里手工加一个并设置成 Gravatar 的 CDN。

在上面的配置文件 `layout/_partial/post/valine.ejs` 中新增：（和参数 avatar 同级）

```
avatar_cdn:'{{ theme.valine.avatar_cdn }}',
```

4、评论，输入邮箱，发现头像已可正确显示

![11](/imgs/valine-gravatars-test.png)



评论接入引用：

[夏天的风]: http://xiaqunfeng.cc/2019/11/06/hexo-valine/

## hexo 中 cdn.jsdelivr.net 无法访问

更换 **cdn 产商，** 使用 cdn.jsdelivr [.net](https://so.csdn.net/so/search?q=.net&spm=1001.2101.3001.7020) 未受污染的子域：

将 **cdn.jsdelivr.net** 域名替换为 **fastly.jsdelivr.net** 或者 **gcore.jsdelivr.net**



## 使用 Hexo-Qiniu-Sync：一键部署静态博客到七牛云的利器

​	[Hexo-Qiniu-Sync](https://gitcode.com/gyk001/hexo-qiniu-sync?utm_source=artical_gitcode) 是一个便捷的工具，它将 Hexo 静态博客与七牛 [云存储](https://so.csdn.net/so/search?q=云存储&spm=1001.2101.3001.7020) 服务紧密集成，允许用户通过简单的命令行操作，快速、稳定地将本地博客内容同步到云端并自动发布。如果你是 Hexo 的用户并且正在寻找一种高效且可靠的云存储解决方案，那么这个项目绝对值得你尝试。

​	详情见《2024-04-15-七牛云搭建hexo博客》、《2024-04-15-hexo使用qshell一键部署静态博客到七牛云》

## hexo 多电脑同步管理一个博客

​	主要的思路是利用 git 分支实现。hexo 生成的静态博客文件默认放在 master 分支上。 hexo 的源文件（部署环境文件）可以都放在 backup分支上（可以新创建一个 backup 分支），换新电脑时，直接 `git clone hexo分支` 进行博客的书写和编译等工作 。

在 Github 的 username.github.io 仓库上新建一个 hexo 分支

**A 电脑备份博客内容到 github**

```auto
方式一（未使用hexo-git-backup插件）：
git init  #第一次可能需要
git add . #添加目录下所有文件 
git commit -m “更新说明” #提交并添加更新说明 
git remote add github https://github.com/yourname/yourname.github.io.git 
git push -u github backup:backup #推送更新到远程仓库，出错加  -f （强制推送） -u（设定默认）

方式一（使用hexo-git-backup插件）：
hexo b
```

**B 电脑拉下远程仓库文件**

在 B 电脑上同样先安装好 node、git、ssh、hexo，然后建好 hexo 文件夹，安装好插件，（然后选做：将备份到远程仓库的文件及文件夹删除），然后执行以下命令：

```auto
git init
git remote add github https://github.com/yourname/yourname.github.io.git 
git pull github backup:backup

npm install #第一次下拉需要安装一下依赖项，后面如果更改仍然需要刷新
```

**发布博客后同步**

在 B 电脑发布完博客之后，记得将博客备份同步到远程仓库。  
执行以下命令：

```auto
方式一（git默认方式）：
git add #可以用git master 查看更改内容  
git commit -m "更新信息"  
git push -u origin hexo:hexo #以后每次提交可以直接git push

方式二（hexo默认方式）：
hexo d

方式三（hexo-git-backup结合GitHub Actions方式）：
hexo b
自动触发GitHub Actions，部署到静态页面分支（正常是master）
```

**平时同步管理**

每次想写博客时，先执行：

![image-20240417093815731](/imgs/image-20240417093815731.png)


```auto
git pull github backup:backup #github为远程主机名
#git pull gitee backup:backup  
```

进行同步更新。

发布完文章后同样按照上面的 发布博客后同步。 同步到远程仓库。

参考命令

[Git push 命令](https://www.yiibai.com/git/git_push.html)

[Git pull 命令](https://www.yiibai.com/git/git_pull.html)

```auto
$ git push <远程主机名> <本地分支名>:<远程分支名>
$ git pull <远程主机名> <远程分支名>:<本地分支名>
$ git clone <版本库的网址>
$ git fetch origin master
$ git remote add [shortname] [url]
```

## 安装和部署 hexo-admin 插件

### Windows

在博客根目录下运行下列指令

```

1、安装hexo-admin
npm install --save hexo-admin -y

2、获取配置hexo 的admin authentification(未配置时，直接进入配置后复制到根目录_config.yml)
vim _config.yml
admin:
  username: xx
  password_hash: xxx
  secret: xxx
  
  
3、配置脚本（根目录执行）
echo "hexo clean && hexo g -d">hexo-deploy.bat

4、配置脚本位置
vim _config.yml
admin:
...
  deployCommand: '.\\hexo-deploy.bat‘

5、发布
hexo server -d
```

指令解释

第一行，下载插件，
第二行，生成一个内容为"hexo clean && hexo g -d"，名为"hexo-deploy"的bat文件。这个教程是对于github的部署的。如果想用来管理gitee的博客，建议修改成echo "hexo clean && hexo g -d && start https://gitee.com/用户名/用户名/pages">hexo-deploy.bat，这样方便在网页端同步更新gitee page。

第三、四行，配置_config.yml文件，
第五行，开启hexo服务。

在浏览器打开localhost:4000/admin/，即可编辑博文。
如果没出意外的话应该是可以的，如果出了意外哪一行没执行成功，就查看代码解释，看看是否完成了相应功能。

在网页中编辑完，直接左上角Deploy，直接点deploy按钮，就可以完成博客的部署。

可能遇到的问题(每次都要输入密码)：查看一下你的_config.yml，将文档最后的deploy的repo从http改为git@github类型。

### linux

```
1、安装hexo-admin
npm install --save hexo-admin -y

2、获取配置hexo 的admin authentification(未配置时，直接进入配置后复制到根目录_config.yml)
vim _config.yml
admin:
  username: xx
  password_hash: xxx
  secret: xxx
  
  
3、配置脚本
vi hexo-deploy.sh
#!/usr/bin/env sh
hexo clean
hexo g -d

4、授权脚本
chmod +x hexo-deploy.sh

5、配置脚本位置
vim _config.yml
admin:
...
deployCommand: ./hexo-deploy.sh

6、发布
hexo server -d
```

**admin authentificati	on**

![image-20240418153522170](/imgs/image-20240418153522170.png)

## 常见问题

### fatal: 'gitee' does not appear to be a git repository

```
fatal: 'gitee' does not appear to be a git repository
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
INFO  Backup done: git
```

提示'gitee' does not appear to be a git repository，需要确认远程仓库是否存在，不存在的话进行添加

```
# 显示所有远程仓库
git remote -v
# 增加一个新的远程仓库，并命名
git remote add [shortname] [url]
```

### fatal: refusing to merge unrelated histories

​	错误通常发生在尝试合并两个不相关的Git仓库历史时。

#### 问题分析

这个错误的根本原因是Git无法确定两个不相关仓库的历史如何彼此关联。Git通过历史记录来跟踪每个提交的父提交，以便构建提交的关系图。当尝试合并两个没有共同祖先的历史时，Git会认为它们是不相关的，因此默认情况下拒绝合并。

这通常发生在以下情况下：

创建了一个新的本地仓库并进行了一些提交，然后尝试将其与远程仓库合并，但远程仓库也已经有了自己的提交历史。

从一个独立的仓库克隆了一个项目，并且这两个仓库没有任何历史共享。

#### 解决方法

要解决fatal: refusing to merge unrelated histories错误，我们可以采取以下几种方法：

##### --allow-unrelated-histories标志

使用--allow-unrelated-histories标志允许合并不相关的历史。这是一种解决问题的快速方法，但请谨慎使用，因为它将两个不同的历史合并到一个新的共同历史中。

```
git pull origin master --allow-unrelated-histories
```


请注意，这可能会导致冲突，我们需要解决这些冲突后再次提交。

##### 创建新分支

如果不想混合两个不相关的历史，我们可以创建一个新的分支，然后将远程仓库的内容合并到该分支中。



```
#创建新分支
git checkout -b new-branch

#拉取远程仓库内容并合并到新分支
git pull origin master

#提交更改
git commit -m "Merge remote branch into new branch"

# 推送到远程仓库
git push origin new-branch
```



##### 重新克隆仓库

如果两个仓库的历史确实是完全不相关的，并且不希望将它们合并在一起，那么我们可以重新克隆一个干净的仓库。这将创建一个全新的本地仓库，不包含任何不相关的历史。

```
# 删除当前仓库目录
rm -rf your-repo-directory

# 重新克隆远程仓库
git clone <repository-url>
```

##### 合并并重写历史（谨慎使用）

如果确定两个仓库的历史应该合并，可以使用--allow-unrelated-histories标志来合并，并使用–rebase选项来重写历史以创建一个干净的合并历史。

```
# 拉取远程仓库内容并合并并重写历史
git pull origin master --rebase=interactive --allow-unrelated-histories

# 解决任何冲突并继续重写历史

# 提交更改
git commit -m "Merge and rewrite history"

# 推送到远程仓库
git push origin master
```

这种方法会重写历史，所以请小心使用，尤其是在多人协作项目中。

#### 总结

fatal: refusing to merge unrelated histories错误通常是由于尝试合并不相关的Git历史而引起的。根据我们的需求，可以使用上述不同的解决方法来处理这个问题。谨慎使用–allow-unrelated-histories和–rebase选项，以确保不会破坏项目的完整性。最终的解决方案取决于项目需求和历史记录。

### Permission denied (publickey).

```
Warning: Permanently added 'gitee.com' (ED25519) to the list of known hosts.
git@gitee.com: Permission denied (publickey).
fatal: Could not read from remote repository.
```

问题：缺少SSH公钥，在gitee新增电脑公钥即可
