---
layout: post
title: 系统开机自启动程序设置
tags:
  - Windows
  - CentOS7
categories:
  - [Windows]
  - [linux]
password: 
date: 2024-03-22
abbrlink: bf358e81
typora-root-url: ./..
---

## windows 将 bat 脚本设置为开机自启动

### 修改注册表的方式

​	进入注册表，点击任务栏开始，输入 regedit.exe，进入 [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run] 位置后，新建一个二进制字符类型的项，数值数据位置填入所需开机自启动的应用程序位置，但是该方式应用于在产的系统会导致无法启动（由于系统使用了杀桌面的方式）。



### 设置脚本启动的方式

​	注意：系统授权过期等原因可能会导致无法启动

​	在开始位置输入 gpedit.msc 进入本地策略组，在计算机配置—Windows 设置—脚本（启动/关闭）位置双击启动，并添加相对应的脚本。

```
使用场景：需要在windows开机启动时直接运行一个bat脚本，通过这个脚本调用写好的python之类的管理工具。
步骤：
1、按下Win + R快捷键打开“运行”对话框
2、输入shell:startup，然后按下回车键
3、这将打开“启动”文件夹，右键点击.bat文件，选择“创建快捷方式”，然后将快捷方式复制或移动到“启动”文件夹中。
4、重启电脑后，Windows将自动运行“启动”文件夹中的所有程序，bat脚本也将自动运行。
```

<!--more-->

### 添加任务计划的方式

在计算机管理下，在任务计划程序库下，点击创建基本任务，按照下面图片描述进行设置操作即可。

![这里写图片描述](/imgs/20171204201910404)

​	注意：可能需要设置选择“不管用户是否登录都要运行”选项，然后回车确定，在弹出来的窗口中点击输入“用户名和密码”，否则在系统过期时无法完成启动。

## centos 将数据库设置为开机自启动

​	在服务器上安装的各种中间件，为了防止意外宕机重启导致的后果，一般都需要配置成开机自启动。但是有些中间件的安装过程中并没有提供相关配置开机自启动的说明文档。今天和各位大朋友们聊一聊 Centos 上配置服务开机自启动的几种方式。

**Centos 下配置服务开机自启动有 3 种方式：**

- **方式一：** 直接在/etc/rc.d/rc.local 中添加服务启动命令；
- **方式二：** 通过 chkconfig 配置服务自启动；
- **方式三：** Centos7 通过 systemctl enble 配置服务自启动。



### **1. 在/etc/rc.d/rc.local 中添加服务启动命令**

/etc/rc.d/rc.local 脚本会在 Centos 系统启动时被自动执行，所以可以把需要开机后执行的命令直接放在这里。

```shell
i /etc/rc.d/rc.local
```

![img](/imgs/2529681-20230601220008454-397450866.png)

想简单点可以直接将服务的启动命令添加到/etc/rc.d/rc.local 中：

![img](/imgs/2529681-20230601220044976-1617277185.png)

**也可以自己编写服务启动的脚本**。由于重启时是以 root 用户重启，需要保证 root 用户有脚本执行权限。

**1）** 编写服务启动的脚本

```shell
i /opt/script/zabbixstart.sh
```

输入启动脚本内容：

```bash
/bin/bash
/home/ampdcp/snc_product/zabbix_proxy/sbin/zabbix_proxy -c
/home/ampdcp/snc_product/zabbix_proxy/etc/zabbix_proxy.conf
```



**2）** 赋予脚本可执行权限

```shell
chmod +x /opt/script/zabbixstart.sh
```



**3）** 打开/etc/rc.d/rc.local 文件，在末尾增加如下内容

```shell
/opt/script/autostart.sh
```



**4）** 在 centos7 中，/etc/rc.d/rc.local 的权限被降低了，所以需要执行如下命令赋予其可执行权限

```shell
chmod +x /etc/rc.d/rc.local
```

#### 设置 oracle 开机启动

```
#如果想用$ORACLE_HOME/bin/dbstart脚本来启动数据库，则需要将/etc/oratab文件中相应的数据库的项置为Y。简单的说就是dbstart脚本根据oratab文件中的配置决定启动哪几个数据库
#FXK等为实例名；/data/oracle/product/11.2.0/db_1为oracle安装目录 
cat /etc/oratab
FXK:/data/oracle/product/11.2.0/db_1:Y
tgysck:/data/oracle/product/11.2.0/db_1:Y
YWK:/data/oracle/product/11.2.0/db_1:Y
JCKZJK:/data/oracle/product/11.2.0/db_1:Y
JCKNEW:/data/oracle/product/11.2.0/db_1:Y

#/etc/rc.d/rc.local脚本会在Centos系统启动时被自动执行
# su oracle -lc 切换oracle用户执行命令，执行完成后切换回原用户
cat /etc/rc.d/rc.local
su oracle -lc "/data/oracle/product/11.2.0/db_1/bin/lsnrctl start"
su oracle -lc "/data/oracle/product/11.2.0/db_1/bin/dbstart"
```

#### 设置人大金仓开机启动

```
#/etc/rc.d/rc.local脚本会在Centos系统启动时被自动执行
# su - kingbase -c 切换kingbase用户执行命令
cat /etc/rc.d/rc.local
su - kingbase -c "/home/kingbase/ES/V8/Server/bin/sys_ctl start -D /home/kingbase/ES/V8/data" 2>/dev/null
```



### **2. 通过 chkconfig 配置**

在 CentOS7 之前，可以通过 chkconfig 来配置开机自启动服务。

**chkconfig 相关命令：**

- chkconfig –-add xxx //把服务添加到 chkconfig 列表；
- chkconfig --del xxx //把服务从 chkconfig 列表中删除；
- chkconfig xxx on //开启开机自动启动；
- chkconfig xxx off //关闭开机自动启动；
- chkconfig --list //查看所有 chklist 中服务；
- chkconfig --list xxx 查看指定服务。

**chkconfig 运行级别 level 和启动顺序的概念：**

**![img](/imgs/2529681-20230601220123976-2076616975-1711094906161-1.png)**

这里的 0 到 6 其实指的就是服务的 level。指定系统服务要在哪一个执行等级中开启或关毕。

- 等级 0 表示：表示关机；
- 等级 1 表示：单用户模式；
- 等级 2 表示：无网络连接的多用户命令行模式；
- 等级 3 表示：有网络连接的多用户命令行模式；
- 等级 4 表示：不可用；
- 等级 5 表示：带图形界面的多用户模式；
- 等级 6 表示：重新启动。

比如如下命令：

//设定 mysqld 在等级 3 和 5 为开机运行服务：

```csharp
chkconfig --level 35 mysqld on
```



//设置 network 服务开机自启动，会把 2～5 的等级都设置为 on：

```csharp
chkconfig network on
```

![img](/imgs/2529681-20230601220206243-1671156388-1711094906161-3.png)

chkconfig 配置的服务启动顺序最后都会在/etc/rc.d/目录下体现出来。

使用 chkconfig 配置 kibana 开机自启实例：

**1）** 在/etc/init.d 目录下，新建脚本 kibana，脚本内容如下

```bash
/bin/bash

# chkconfig: 2345 98 02
# description: kibana
```

注意：每个被 chkconfig 管理的服务需要在对应的 init.d 下的脚本加上两行或者更多行的注释。第一行告诉 chkconfig 缺省启动的运行级以及启动和停止的优先级。如果某服务缺省不在任何运行级启动，那么使用 - 代替运行级。第二行对服务进行描述，可以用\ 跨行注释。

解释说明：配置 kibana 服务在 2、3、4、5 的 level 等级下脚本执行顺序是 98。

```bash
KIBANA_HOME=/usr/local/kibana-6.2.4-linux-x86_64
case $1 in
 start)
         $KIBANA_HOME/bin/kibana &
         echo "kibana start"
         ;;
 stop)
    kibana_pid_str=`netstat -tlnp |grep 5601 | awk '{print $7}'`
    kibana_pid=`echo ${kibana_pid_str%%/*}`
    kill -9 $kibana_pid
    echo "kibana stopped"
    ;;
 restart)
    kibana_pid_str=`netstat -tlnp |grep 5601 | awk '{print $7}'`
    kibana_pid=${kibana_pid_str%%/*}
    kibana_pid=`echo ${kibana_pid_str%%/*}`
    kill -9 $kibana_pid
    echo "kibana stopped"

    $KIBANA_HOME/bin/kibana &
    echo "kibana start"
    ;;
 status)
    kibana_pid_str=`netstat -tlnp |grep 5601 | awk '{print $7}'`
    if test -z $kibana_pid_str; then
       echo "kibana is stopped"
    else
       pid=`echo ${kibana_pid_str%%/*}`
       echo "kibana is started,pid:"${pid}
    fi
    ;;
*)
    echo "start|stop|restart|status"
    ;;
esac
```

**2）** 增加脚本的可执行权限

```shell
hmod +x kibana
```



**3）** 查看 chkconfig list

```bash
hkconfig --list
```



**4）** 把服务添加到 chkconfig 列表

```bash
hkconfig --add kibana
```



**5）** 设置 kibana 服务自启动

\#chkconfig kibana on //开启开机自动启动。

\#查看 kibana 服务自启动状态：

\#chkconfig --list kibana //如果 2~5 都是 on，就表明会自动启动了。

#### centos 人大金仓启动脚本

在 CentOS 系统中，如果你想要创建一个启动脚本来启动人大金仓数据库（KingbaseES），你可以按照以下步骤操作：

1. 创建一个新的启动脚本文件。
2. 编写启动人大金仓数据库的命令。
3. 将该脚本设置为可执行文件。
4. 配置系统以便在启动时运行该脚本。

以下是一个简单的示例脚本，假设你已经安装了人大金仓数据库并知道如何启动它：

```bash
/bin/bash
# kingbase_start.sh

# 启动人大金仓数据库的命令，这个命令可能需要根据你的安装路径和配置进行调整
/opt/Kingbase/ES/V8/bin/kingbase -D /opt/Kingbase/ES/V8/data &
 
# 确保数据库服务器已经启动
if ps -ef | grep -v grep | grep kingbase > /dev/null
then
    echo "KingbaseES is running..."
else
    echo "KingbaseES failed to start."
fi
```

要使这个脚本在启动时运行，你可以将其放置在 `/etc/init.d/` 目录下，并使用 `chkconfig` 命令来配置它：

```bash
将脚本复制到 init.d 目录下
sudo cp kingbase_start.sh /etc/init.d/kingbase
 
# 设置为可执行文件
sudo chmod +x /etc/init.d/kingbase
 
# 添加到启动脚本
sudo chkconfig --add kingbase
 
# 设置为开机自启
sudo chkconfig kingbase on
```

确保你的人大金仓数据库安装路径和启动参数是正确的，否则启动脚本可能无法正常工作。

### **3. Centos7 通过 systemctl 配置 kibana 服务自启动**

在 Centos7 后，更推荐通过 systemctl 来控制服务。

![img](/imgs/2529681-20230601220252995-1642239706-1711094906161-5.png)

**3.1 systemctl 服务的目录介绍**

知道服务的管理是通过 systemd，而 systemd 的配置文件大部分放置于 /usr/lib/systemd/目录内。但是 Red Hat 官方文件指出， 该目录的文件主要是原本软件所提供的设置，建议不要修改！而要修改的位置应该放置于/etc/systemd/system/目录内。

**3.2 建立 kibana 开机服务件**

```shell
d /etc/systemd/system/
#vim kibana.service
```



脚本内容：

```ini
[Unit]
Description=kibana
After=network.target
[Service]
Type=forking
User=root
Group=root
ExecStart=/etc/init.d/kibana start
ExecReload=/etc/init.d/kibana restart
ExecStop=/etc/init.d/kibana stop
PrivateTmp=true
[Install]
WantedBy=multi-user.target
```



这里 ExecStart、ExecReload、ExecStop 的命令还是借助了上文在/etc/init.d 目录下配置 kibana 脚本来实现。

- [Service] 的启动、重启、停止命令全部要求使用绝对路径。
- [Install] 服务安装的相关设置，可设置为多用户。

参数说明：

- Description: 描述服务；
- After: 描述服务类别；
- [Service] 服务运行参数的设置；
- Type = forking 是后台运行的形式；
- User 服务启动用户；
- Group 服务启动用户组；
- ExecStart 为服务的具体运行命令；
- ExecReload 为重启命令；
- ExecStop 为停止命令；
- PrivateTmp = True 表示给服务分配独立的临时空间。

**3.3 赋予执行权限**

```shell
hmod 754 kibana.service
```

**3.4 服务的启动、停止、开机启动**

//重新加载某个服务的配置文件，如果新安装了一个服务，归属于 systemctl 管理，要是新服务的服务程序配置文件生效，需重新加载。

```cpp
#systemctl daemon-reload
//查看服务状态
#systemctl status kibana.service
```



服务状态说明：

![img](/imgs/2529681-20230601221007190-886504275-1711094906161-7.png)





 
